os: osx
language: swift
osx_image: xcode9.2
branches:
  only:
  - develop
  - master
env:
  global:
  - LC_CTYPE=en_US.UTF-8
  - LANG=en_US.UTF-8
  - PROJECT=UIRounding.xcodeproj
  - IOS_FRAMEWORK_SCHEME="UIRounding_iOS"
  - MACOS_FRAMEWORK_SCHEME="UIRounding_macOS"
  - TVOS_FRAMEWORK_SCHEME="UIRounding_tvOS"
  - WATCHOS_FRAMEWORK_SCHEME="UIRounding_watchOS"
  - IOS_SDK=iphonesimulator11.2
  - OSX_SDK=macosx10.13
  - TVOS_SDK=appletvsimulator11.2
  - WATCHOS_SDK=watchsimulator4.2
  - secure: ucmPuoCP7kbhK5jZ+TtJOKojkUH5kLovcO68JaL/7iwU8ABi2ewy8IV7zEA2YGleaJHi+RobbHof57pjn2owD3/wR/ReCn9jrt2vOwZOnD1Eg0OSg2eaNbEmyv0WkFWRqa7yRhsfTJGr97x5cUfAy9OjndZduieUBzAYHnvgIe2RaF+Kr17ytsES6b6XsQPSg8NulaaOUEM8tht7pBlu6VqtMoK4dveU6vvba8AE0jMp/6PVovUm5ykcjgtuatTetqqGI6oJ3AiWgTW7KKsaXClE5xTeqM+IATRa4ygvK9ZqwcQtgoGTg/rqC3Pifz+FhvbcF3P3VPocJum8QpDhLVT6/wbh9/gDlh/RKT8/GIcDvWc6GA0JeZJ1c5lZCIJGG0I5o8BM8Ogsm7OG6hNxrDt3Rrb2TuOrgCsMBueZHZaXq1hIMo5h1r/KTanM8KKCEy/PoXs7yo3uU52pxfOR9diaj/XQKvTOOXCOTCZoK69pV5/tRQo8/xmFzvumZuwDY0N91W39dm6tRTeDqssSA2Iu/dy8KQTXAyH7TCDOwjka24V/VJLdjz1j2cdC3wIe81NLL9NJDlpY0DszGeLKN3hgvVBWyhPxBkiu8eJlJeCqAitmW0ePLgcRppBgs+uM1ActxnCzZLJxHqkr5KdIckw0QDwKa+K+2LbIYJfQKcw=
  matrix:
  - DESTINATION="OS=4.2,name=Apple Watch - 42mm" SCHEME="$WATCHOS_FRAMEWORK_SCHEME"  RUN_TESTS="NO"
  - DESTINATION="OS=3.2,name=Apple Watch - 42mm" SCHEME="$WATCHOS_FRAMEWORK_SCHEME"  RUN_TESTS="NO"
  - DESTINATION="OS=2.2,name=Apple Watch - 42mm" SCHEME="$WATCHOS_FRAMEWORK_SCHEME"  RUN_TESTS="NO"

  - DESTINATION="OS=11.2,name=iPhone X"          SCHEME="$IOS_FRAMEWORK_SCHEME"      RUN_TESTS="YES"
  - DESTINATION="OS=10.3.1,name=iPhone 7 Plus"   SCHEME="$IOS_FRAMEWORK_SCHEME"      RUN_TESTS="YES"
  - DESTINATION="OS=9.3,name=iPhone 6"           SCHEME="$IOS_FRAMEWORK_SCHEME"      RUN_TESTS="YES"
  - DESTINATION="OS=8.4,name=iPhone 4S"          SCHEME="$IOS_FRAMEWORK_SCHEME"      RUN_TESTS="YES"

  - DESTINATION="OS=11.2,name=Apple TV 4K"       SCHEME="$TVOS_FRAMEWORK_SCHEME"     RUN_TESTS="YES"
  - DESTINATION="OS=10.2,name=Apple TV 1080p"    SCHEME="$TVOS_FRAMEWORK_SCHEME"     RUN_TESTS="YES"
  - DESTINATION="OS=9.2,name=Apple TV 1080p"     SCHEME="$TVOS_FRAMEWORK_SCHEME"     RUN_TESTS="YES"

  - DESTINATION="arch=x86_64"                    SCHEME="$MACOS_FRAMEWORK_SCHEME"    RUN_TESTS="YES"
script:
  - set -o pipefail

  # Build Framework in Debug and Run Tests if specified
  - if [ $RUN_TESTS == "YES" ]; then
      xcodebuild -project "$PROJECT" -scheme "$SCHEME" -sdk "$SDK" -destination "$DESTINATION" -configuration Debug ONLY_ACTIVE_ARCH=NO test | xcpretty -c;
    else
      xcodebuild -project "$PROJECT" -scheme "$SCHEME" -sdk "$SDK" -destination "$DESTINATION" -configuration Debug ONLY_ACTIVE_ARCH=NO build | xcpretty -c;
    fi

before_install:
- brew outdated carthage || brew upgrade carthage
- brew outdated swiftlint || brew upgrade swiftlint
before_script:
- carthage bootstrap
